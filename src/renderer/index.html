<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>OpenClaw 管理器</title>
  <script src="../../node_modules/lucide/dist/umd/lucide.min.js"></script>
  <style>
    :root {
      --bg: #09090b;
      --sidebar-bg: #121214;
      --card-bg: #18181b;
      --border: #27272a;
      --border-hover: #3f3f46;
      --primary: #3b82f6;
      --primary-hover: #2563eb;
      --text: #fafafa;
      --text-muted: #a1a1aa;
      --danger: #ef4444;
      --success: #22c55e;
      --warning: #f59e0b;
      --font-sans: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { 
      font-family: var(--font-sans); 
      background: var(--bg); 
      color: var(--text); 
      display: flex; 
      height: 100vh; 
      overflow: hidden;
      -webkit-font-smoothing: antialiased;
    }
    
    /* Sidebar */
    .sidebar { 
      width: 240px; 
      background: var(--sidebar-bg); 
      border-right: 1px solid var(--border); 
      padding: 24px 12px; 
      flex-shrink: 0; 
      display: flex;
      flex-direction: column;
    }
    .sidebar h2 { 
      padding: 0 16px 24px; 
      font-size: 18px; 
      font-weight: 700;
      color: var(--text); 
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .sidebar .nav-item { 
      padding: 10px 16px; 
      cursor: pointer; 
      font-size: 14px; 
      font-weight: 500;
      color: var(--text-muted); 
      transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1); 
      border-radius: 8px;
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 4px;
    }
    .sidebar .nav-item i { width: 18px; height: 18px; }
    .sidebar .nav-item:hover { background: #1c1c1f; color: var(--text); }
    .sidebar .nav-item.active { 
      background: #27272a; 
      color: var(--primary); 
    }

    /* Main Container */
    .main { 
      flex: 1; 
      overflow-y: auto; 
      padding: 40px 48px; 
      position: relative;
      scroll-behavior: smooth;
    }
    .main h1 { 
      font-size: 24px; 
      font-weight: 700;
      margin-bottom: 32px; 
      letter-spacing: -0.025em;
    }

    /* Transition for pages */
    .page-content {
      animation: pageIn 0.3s ease-out;
    }
    @keyframes pageIn {
      from { opacity: 0; transform: translateY(8px); }
      to { opacity: 1; transform: translateY(0); }
    }

    /* Cards */
    .card { 
      background: var(--card-bg); 
      border: 1px solid var(--border); 
      border-radius: 12px; 
      padding: 24px; 
      margin-bottom: 20px; 
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
    }
    .card h3 { 
      font-size: 12px; 
      color: var(--text-muted); 
      text-transform: uppercase; 
      letter-spacing: 0.05em; 
      margin-bottom: 16px; 
      font-weight: 600;
    }

    /* Rows */
    .agent-row { 
      display: flex; 
      align-items: center; 
      justify-content: space-between; 
      padding: 12px 0; 
      border-bottom: 1px solid var(--border); 
    }
    .agent-row:last-child { border-bottom: none; }
    .agent-name { font-weight: 600; font-size: 15px; color: var(--text); }
    .agent-id { font-size: 12px; color: var(--text-muted); margin-top: 2px; }

    /* Inputs & Selects */
    select, .form-input { 
      background: #09090b; 
      color: var(--text); 
      border: 1px solid var(--border); 
      border-radius: 8px; 
      padding: 8px 12px; 
      font-size: 14px; 
      cursor: pointer; 
      transition: border-color 0.2s;
      outline: none;
    }
    select:focus, .form-input:focus { border-color: var(--primary); }
    select { min-width: 200px; }

    /* Buttons */
    .btn { 
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      padding: 8px 16px; 
      border: 1px solid transparent;
      border-radius: 8px; 
      font-size: 14px; 
      cursor: pointer; 
      font-weight: 600; 
      transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1); 
    }
    .btn-primary { background: var(--primary); color: #fff; }
    .btn-primary:hover { background: var(--primary-hover); transform: translateY(-1px); }
    .btn-primary:active { transform: translateY(0); }
    
    .btn-danger { background: rgba(239, 68, 68, 0.1); color: var(--danger); border: 1px solid rgba(239, 68, 68, 0.2); }
    .btn-danger:hover { background: var(--danger); color: #fff; }
    
    .btn-secondary { background: #27272a; color: var(--text); }
    .btn-secondary:hover { background: #3f3f46; }
    
    .btn:disabled { opacity: 0.4; cursor: not-allowed; transform: none !important; }

    .btn-dirty { 
      background: var(--success); 
      color: #fff; 
      animation: pulseGlow 2s infinite; 
    }
    @keyframes pulseGlow {
      0% { box-shadow: 0 0 0 0 rgba(34, 197, 94, 0.4); }
      70% { box-shadow: 0 0 0 10px rgba(34, 197, 94, 0); }
      100% { box-shadow: 0 0 0 0 rgba(34, 197, 94, 0); }
    }

    /* Badges */
    .badge { padding: 4px 10px; border-radius: 20px; font-size: 12px; font-weight: 600; display: inline-flex; align-items: center; gap: 6px; }
    .badge-green { background: rgba(34, 197, 94, 0.1); color: var(--success); }
    .badge-red { background: rgba(239, 68, 68, 0.1); color: var(--danger); }

    /* Toast */
    .toast { 
      position: fixed; top: 24px; right: 24px; 
      padding: 12px 20px; border-radius: 12px; 
      font-size: 14px; font-weight: 500;
      z-index: 1000; box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.2);
      backdrop-filter: blur(8px);
      border: 1px solid var(--border);
      animation: toastIn 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    }
    @keyframes toastIn { from { transform: translateX(100%) scale(0.9); opacity: 0; } to { transform: translateX(0) scale(1); opacity: 1; } }
    .toast-success { background: rgba(24, 24, 27, 0.9); border-left: 4px solid var(--success); }
    .toast-error { background: rgba(24, 24, 27, 0.9); border-left: 4px solid var(--danger); }

    /* Modal */
    .modal-overlay { 
      position: fixed; inset: 0; 
      background: rgba(0, 0, 0, 0.8); 
      backdrop-filter: blur(4px);
      z-index: 900; display: flex; align-items: center; justify-content: center; 
    }
    .modal { 
      background: var(--card-bg); 
      border: 1px solid var(--border); 
      border-radius: 16px; padding: 32px; 
      width: 100%; max-width: 500px;
      animation: modalIn 0.3s ease-out;
    }
    @keyframes modalIn { from { opacity: 0; transform: scale(0.95) translateY(10px); } to { opacity: 1; transform: scale(1) translateY(0); } }

    /* Workspace Editor */
    #page-workspace { display: flex; flex-direction: column; height: calc(100vh - 80px); }
    .ws-toolbar { display: flex; align-items: center; gap: 12px; margin-bottom: 20px; flex-shrink: 0; }
    .ws-file-tabs {
      display: flex; gap: 8px; flex-wrap: wrap; align-items: center;
    }
    .ws-file-tab {
      padding: 6px 14px; border-radius: 6px; font-size: 13px; font-weight: 500;
      cursor: pointer; background: #18181b; color: var(--text-muted);
      border: 1px solid var(--border); transition: all 0.2s;
    }
    .ws-file-tab:hover { border-color: var(--border-hover); color: var(--text); }
    .ws-file-tab.active { background: #27272a; color: var(--primary); border-color: var(--primary); }
    
    .ws-editor-wrap { 
      display: flex; flex: 1; border: 1px solid var(--border); 
      border-radius: 12px; overflow: hidden; background: #09090b; 
    }
    .ws-pane-header { 
      padding: 8px 16px; font-size: 11px; font-weight: 700; 
      color: var(--text-muted); text-transform: uppercase; 
      background: #121214; border-bottom: 1px solid var(--border); 
    }
    textarea#ws-editor { 
      flex: 1; background: transparent; color: #e4e4e7; 
      padding: 20px; font-family: 'JetBrains Mono', 'Fira Code', monospace; 
      font-size: 14px; line-height: 1.6; resize: none; outline: none; border: none;
    }
    .ws-preview-body {
      padding: 24px; color: #d4d4d8; line-height: 1.7;
      flex: 1; overflow-y: auto; min-height: 0;
    }
    .ws-preview-body h1 { font-size: 22px; border-bottom: 1px solid var(--border); padding-bottom: 8px; margin-bottom: 16px; }

    /* Provider Tags */
    .provider-model-tag { 
      background: #27272a; border: 1px solid var(--border); 
      border-radius: 6px; padding: 4px 10px; font-size: 12px; 
      color: var(--text-muted); margin: 0 6px 6px 0; display: inline-block;
    }

    /* Restart required indicator */
    .restart-notice {
      display: flex;
      align-items: center;
      gap: 8px;
      background: rgba(245, 158, 11, 0.08);
      border: 1px solid rgba(245, 158, 11, 0.2);
      border-radius: 8px;
      padding: 10px 16px;
      font-size: 12px;
      color: var(--warning);
      margin-bottom: 20px;
    }

    .gw-log-toolbar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      margin-bottom: 12px;
    }
    .gw-log-toolbar h3 { margin-bottom: 0; }
    .gw-log-list {
      max-height: 360px;
      overflow-y: auto;
      border: 1px solid var(--border);
      border-radius: 10px;
      padding: 12px;
      background: #0f0f12;
    }
    .gw-log-entry {
      border: 1px solid var(--border);
      border-radius: 10px;
      padding: 12px;
      background: #141418;
    }
    .gw-log-entry + .gw-log-entry { margin-top: 10px; }
    .gw-log-meta {
      display: flex;
      align-items: center;
      gap: 8px;
      flex-wrap: wrap;
      font-size: 12px;
      color: var(--text-muted);
      margin-bottom: 8px;
    }
    .gw-log-tag {
      display: inline-flex;
      align-items: center;
      padding: 2px 8px;
      border-radius: 999px;
      border: 1px solid transparent;
      font-size: 11px;
      font-weight: 600;
    }
    .gw-log-tag-pending {
      color: var(--warning);
      background: rgba(245, 158, 11, 0.1);
      border-color: rgba(245, 158, 11, 0.25);
    }
    .gw-log-tag-success {
      color: var(--success);
      background: rgba(34, 197, 94, 0.1);
      border-color: rgba(34, 197, 94, 0.25);
    }
    .gw-log-tag-error {
      color: var(--danger);
      background: rgba(239, 68, 68, 0.1);
      border-color: rgba(239, 68, 68, 0.25);
    }
    .gw-log-label {
      font-size: 11px;
      font-weight: 600;
      color: var(--text-muted);
      margin-bottom: 4px;
      text-transform: uppercase;
      letter-spacing: 0.04em;
    }
    .gw-log-pre {
      margin: 0;
      font-size: 12px;
      line-height: 1.5;
      white-space: pre-wrap;
      word-break: break-word;
      background: #09090b;
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 10px;
      color: #d4d4d8;
    }
    .gw-log-block + .gw-log-block { margin-top: 8px; }

    .oc-log-controls {
      display: flex;
      align-items: center;
      gap: 12px;
      flex-wrap: wrap;
    }
    .oc-log-controls select { min-width: 200px; }
    .oc-log-meta {
      margin-top: 12px;
      font-size: 12px;
      color: var(--text-muted);
      word-break: break-all;
    }
    .oc-log-viewer {
      border: 1px solid var(--border);
      border-radius: 10px;
      background: #09090b;
      max-height: 560px;
      overflow-y: auto;
      padding: 12px;
    }
    .oc-log-content {
      margin: 0;
      color: #d4d4d8;
      font-size: 12px;
      line-height: 1.5;
      white-space: pre-wrap;
      word-break: break-word;
      font-family: 'JetBrains Mono', 'Fira Code', monospace;
    }
    .oc-log-hint {
      margin-top: 8px;
      font-size: 12px;
      color: var(--text-muted);
    }

    .hidden { display: none !important; }
    .spin { animation: spin 1s linear infinite; }
    @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }

    /* Skills Tab */
    .sk-tab {
      padding: 6px 14px; border-radius: 6px; font-size: 13px; font-weight: 500;
      cursor: pointer; background: #18181b; color: var(--text-muted);
      border: 1px solid var(--border); transition: all 0.2s;
    }
    .sk-tab:hover { border-color: var(--border-hover); color: var(--text); }
    .sk-tab.active { background: #27272a; color: var(--primary); border-color: var(--primary); }
  </style>
</head>
<body>
  <div class="sidebar">
    <h2><i data-lucide="shell" style="color:var(--primary)"></i> OpenClaw</h2>
    <div style="margin-top: 12px">
      <div class="nav-item active" data-page="config">
        <i data-lucide="sliders-horizontal"></i> Agent 模型配置
      </div>
      <div class="nav-item" data-page="providers">
        <i data-lucide="zap"></i> Provider 管理
      </div>
      <div class="nav-item" data-page="workspace">
        <i data-lucide="file-text"></i> Agent 身份文件管理
      </div>
      <div class="nav-item" data-page="gateway">
        <i data-lucide="globe"></i> 网关管理
      </div>
      <div class="nav-item" data-page="logs">
        <i data-lucide="scroll-text"></i> 日志查看
      </div>
      <div class="nav-item" data-page="bindings">
        <i data-lucide="git-branch"></i> 路由绑定
      </div>
      <div class="nav-item" data-page="channels">
        <i data-lucide="radio"></i> Channel 管理
      </div>
      <div class="nav-item" data-page="agent-advanced">
        <i data-lucide="settings"></i> Agent 高级配置
      </div>
      <div class="nav-item" data-page="tools-config">
        <i data-lucide="wrench"></i> Tools 配置
      </div>
      <div class="nav-item" data-page="skills">
        <i data-lucide="package"></i> Skills 管理
      </div>
    </div>
  </div>

  <div class="main">
    <div id="page-config" class="page-content">
      <h1>Agent 模型配置</h1>
      <div id="config-loading" class="loading">加载配置中...</div>
      <div id="agents-list"></div>
      <div id="default-model-card"></div>
    </div>

    <div id="page-providers" class="hidden page-content">
      <h1>Model Provider 管理</h1>
      <div style="margin-bottom:24px">
        <button class="btn btn-primary" id="btn-add-provider">
          <i data-lucide="plus"></i> 添加 Provider
        </button>
      </div>
      <div id="providers-list"></div>
    </div>

    <div id="page-workspace" class="hidden page-content">
      <h1>Agent 身份文件编辑</h1>
      <div class="ws-toolbar">
        <select id="ws-agent-select"><option value="">选择 Agent...</option></select>
        <div class="ws-file-tabs" id="ws-file-tabs"></div>
        <div style="flex:1"></div>
        <button class="btn btn-secondary" id="ws-btn-save" disabled>保存</button>
      </div>
      <div class="ws-editor-wrap">
        <div class="ws-pane" style="flex:1 1 0; min-width:0; display:flex; flex-direction:column; border-right:1px solid var(--border)">
          <div class="ws-pane-header">Editor</div>
          <textarea id="ws-editor" spellcheck="false" placeholder="选择文件开始编辑..."></textarea>
        </div>
        <div class="ws-pane" style="flex:1 1 0; min-width:0; display:flex; flex-direction:column; background: #0c0c0e">
          <div class="ws-pane-header">Preview</div>
          <div id="ws-preview" class="ws-preview-body"></div>
        </div>
      </div>
    </div>

    <div id="page-gateway" class="hidden page-content">
      <h1>网关管理</h1>
      <div class="card">
        <h3>网关状态</h3>
        <div id="gw-status" class="loading">查询中...</div>
      </div>
      <div class="card">
        <h3>操作</h3>
        <div class="btn-group" style="display:flex; gap:12px">
          <button class="btn btn-primary" id="btn-gw-start"><i data-lucide="play"></i> 启动</button>
          <button class="btn btn-danger" id="btn-gw-stop"><i data-lucide="square"></i> 停止</button>
          <button class="btn btn-secondary" id="btn-gw-restart"><i data-lucide="refresh-cw"></i> 重启</button>
          <button class="btn btn-secondary" id="btn-gw-refresh"><i data-lucide="search"></i> 刷新</button>
        </div>
      </div>
      <div class="card">
        <h3>网关配置</h3>
        <div id="gw-config-info"></div>
      </div>
      <div class="card">
        <div class="gw-log-toolbar">
          <h3>执行日志</h3>
          <button class="btn btn-secondary" id="btn-gw-log-clear"><i data-lucide="trash-2"></i> 清空</button>
        </div>
        <div id="gw-logs" class="gw-log-list"><span class="loading">暂无执行日志</span></div>
      </div>
    </div>

    <div id="page-logs" class="hidden page-content">
      <h1>OpenClaw 日志</h1>
      <div class="card">
        <h3>读取设置</h3>
        <div class="oc-log-controls">
          <select id="oc-log-source">
            <option value="gateway-file">Gateway 文件日志（JSONL）</option>
            <option value="service-stdout">服务日志（gateway.log）</option>
            <option value="service-stderr">服务错误日志（gateway.err.log）</option>
          </select>
          <select id="oc-log-interval">
            <option value="10000">自动刷新：10s</option>
            <option value="30000">自动刷新：30s</option>
            <option value="60000">自动刷新：1min</option>
          </select>
          <button class="btn btn-secondary" id="btn-oc-log-refresh"><i data-lucide="refresh-cw"></i> 立即刷新</button>
          <button class="btn btn-secondary" id="btn-oc-log-clear"><i data-lucide="eraser"></i> 清空显示</button>
        </div>
        <div id="oc-log-meta" class="oc-log-meta">等待读取日志...</div>
      </div>
      <div class="card">
        <h3>日志内容</h3>
        <div id="oc-log-viewer" class="oc-log-viewer">
          <pre id="oc-log-content" class="oc-log-content"></pre>
        </div>
        <div class="oc-log-hint">支持滚动查看，自动刷新间隔可在上方设置。</div>
      </div>
    </div>

    <div id="page-bindings" class="hidden page-content">
      <h1>路由绑定管理</h1>
      <div style="margin-bottom:24px">
        <button class="btn btn-primary" id="btn-add-binding"><i data-lucide="plus"></i> 添加绑定</button>
      </div>
      <div id="bindings-list"></div>
    </div>

    <div id="page-channels" class="hidden page-content">
      <h1>Channel 管理</h1>
      <div style="margin-bottom:24px">
        <button class="btn btn-primary" id="btn-add-channel">
          <i data-lucide="plus"></i> 添加 Channel
        </button>
      </div>
      <div id="channels-editor"></div>
    </div>

    <div id="page-agent-advanced" class="hidden page-content">
      <h1>Agent 高级配置</h1>
      <div id="agent-advanced-editor"></div>
    </div>

    <div id="page-tools-config" class="hidden page-content">
      <h1>Tools 配置</h1>
      <div class="restart-notice">
        <span>修改此页面的配置后需要重启网关才能生效</span>
      </div>
      <div id="tools-config-editor"></div>
    </div>

    <div id="page-skills" class="hidden page-content">
      <h1>Skills 管理</h1>
      <div class="restart-notice">
        <span>修改 Skills 配置后需要重启网关才能生效</span>
      </div>
      <div class="sk-tabs" style="display:flex;gap:8px;margin-bottom:20px;flex-wrap:wrap">
        <div class="sk-tab active" data-sk-tab="bundled">Bundled</div>
        <div class="sk-tab" data-sk-tab="managed">全局 Skills</div>
        <div class="sk-tab" data-sk-tab="workspace">工作区 Skills</div>
        <div class="sk-tab" data-sk-tab="personal">个人 Skills</div>
      </div>
      <div id="skills-editor"></div>
    </div>
  </div>

  <script src="../../node_modules/marked/lib/marked.umd.js"></script>
  <script src="../../node_modules/dompurify/dist/purify.min.js"></script>
  <script>
    // Initialize icons
    lucide.createIcons();
  </script>
  <script src="app.js"></script>
</body>
</html>
